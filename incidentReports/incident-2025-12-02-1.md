# Incident: 2025-12-02 11-48-55

## Summary

Between the hour of **11:48** and **12:19** on **2025-12-02**, **all users** attempting
to order pizzas were met with immediate failure. The incident was triggered by a 
**scheduled Chaos Monkey attack** on the JWT Pizza Factory that activated at 
exactly **11:48:55 UTC**.
A deliberately injected chaos fault in the order processing endpoint caused every pizza
order request to return a 500 Internal Server Error containing a secret URL. The event was
detected by **Grafana alerts**. The on-call engineer investigated logs, reproduced the failure,
discovered the hidden URL in the error payload, visited it, and thereby terminated the 
chaos.

This **SEV-1** incident affected **100 % of users attempting to order** for **~31 minutes**. No real customer funds were lost, but a lot of virtual pepperoni was left unsold.


## Detection

This incident was detected when the **“Pizza purchases failing”** Grafana alert fired at **11:48:55 UTC** and the on-call engineer 
was paged via SMS and push notification.
The alert fired only once and stayed active for the entire incident. Response was acknowledged within 2 minutes.

While investigating, the team also checked request latency, HTTP requests, and logs; and metrics 
like the error logs and pizza failure were in a peaking state.

## Impact

For **31 minutes** between **11:48 UTC and 12:19 UTC** on **12/02/2025**, users could not 
successfully complete any pizza orders. This incident affected **100 % of active ordering 
sessions**, who received 500 errors when trying to buy pizza. No support tickets were 
submitted before the incident was resolved.


## Timeline

All times are UTC.

- 11:48:55 – Chaos Monkey attack triggered
- 11:48:56 – Grafana alert fired and on-call (fc10iguelespinoza) was paged via SMS + push
- 11:50:06 – On-call acknowledged the alert
- 12:07:28 – On-call acknowledged the alert via Web and started investigation
- 12:10:00 – Team identified the 500 errors on pizza orders, found the hidden “Pizza Factory Failure Reporting URL” in the response payload
- 12:10:00 – 12:15:00 – Team intentionally waited ~5 minutes observing metrics (latency, HTTP Requests, error-log volume) 
to verify whether secondary alerts would fire with current thresholds
- 12:15:30 – Team visited the hidden failure-reporting URL → Chaos Monkey terminated the attack
- 12:16:10 – Successful test orders confirmed → pizza ordering fully restored
- 12:19:00 – Incident declared resolved

## Response

After receiving an OnCall alert at **11:48:58 UTC**, the on-call engineer came online at **12:07:28 UTC** in the Grafana incident channel.

The on-call engineer started investigating the incident by checking the error logs, reproducing the failure, 
and discovering the hidden URL in the error payload. The on-call engineer checked the metrics again for another 5 minutes
to check that the chaos was terminated.
## Root cause

Deliberately injected chaos code was remotely activated by the Chaos Monkey, returning 500 errors with a secret URL 
embedded in the response.

## Resolution

Service was restored by discovering and visiting the hidden URL (which in my case was 
"https://pizza-factory.cs329.click/api/support/3239b0107c314d68ba3fb6dd521d9033/report/3fx4vk6s") returned in the 500 
response bodies. Visiting the URL signaled the Chaos Monkey controller to disable the fault injection, immediately 
returning the endpoint to normal behavior. No more pizza orders were rejected, and all metrics and logs were
back to normal.
## Prevention

This type of incident can recur anywhere similar chaos code is present, and it reveals a 
serious security flaw: the backend can be remotely manipulated by unauthorized parties through the injected fault 
mechanism. We could run chaos experiments only through authenticated and authorized users.

## Action items
1. Remove all chaos-injection backdoors from the code
2. Run future chaos experiments only with official tools that have auth and auto-timeout
3. Add a CI check that blocks any new endpoints containing words like “chaos.”
4. Update the “Pizza Order Failures” runbook with clear chaos-termination steps
5. Reward the on-call engineer for their time and effort.